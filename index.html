<!DOCTYPE html>
<html lang="en-us">
	<head>
		<LINK href="stylesheets/stylesheet.css" rel="stylesheet" type="text/css">
	</head>
	<body>
	<script>
	
	function mult(a,b){
		var forward = 1e5
		var reverse = forward*forward
		a *= forward
		b *= forward
		var number3 = a*b
		return number3/reverse
	}
	
	Number.prototype.cutZero = function(){
		var numberString = this.toPrecision(15)
		var n = 0
		while (n<1000){
			n++
			var lastChar = numberString.slice(-1)
			if (lastChar=="0"){
				numberString=numberString.slice(0,-1)
			} else {
				break
			}
		}
		return numberString
	}
	
	function calculate_this() {
		
		var sigFig = parseInt(document.getElementById("signif").value)
		
		var stream1MassFlow = eval(document.getElementById("stream1MassFlow").value)
		
		var stream1InletTemp = eval(document.getElementById("stream1InletTemp").value)
		var stream1OutletTemp = eval(document.getElementById("stream1OutletTemp").value)
		var stream1MeanTemp=mult(.5,(stream1InletTemp+stream1OutletTemp))
		var stream1TempDiff = stream1OutletTemp - stream1InletTemp
		document.getElementById('results').innerHTML = "Stream 1 [Shellside] Mean Temperature: " + stream1MeanTemp.cutZero() + " °C<br>"
		
		var stream1InSHC = eval(document.getElementById("stream1InletSHC").value)
		var stream1OutSHC = eval(document.getElementById("stream1OutletSHC").value)
		var stream1MeanSHC=mult(.5,(stream1InSHC+stream1OutSHC))
		document.getElementById('results').innerHTML += "Stream 1 [Shellside] Mean Spec Heat Capacity: " + stream1MeanSHC.cutZero() + " J/kgK<br>"
		
		var duty = mult(mult(stream1MassFlow,stream1MeanSHC),stream1TempDiff)
		document.getElementById('results').innerHTML += "Duty: " + Math.abs(duty).cutZero() + " W<br><br>"
		
		var stream2MassFlow = eval(document.getElementById("stream2MassFlow").value)
		var stream2InletTemp = eval(document.getElementById("stream2InletTemp").value)
		
		var tubeStreamInletSHC = eval(document.getElementById("stream2InletSHC").value)
		var tubeStreamOutletSHC = eval(document.getElementById("stream2OutletSHC").value)
		var tubeStreamMeanSHC=mult((tubeStreamInletSHC+tubeStreamOutletSHC),.5)
		document.getElementById('results').innerHTML += "Stream 2 [Tubeside] Mean Spec Heat Capacity: " + tubeStreamMeanSHC.cutZero() + " J/kgK<br>"
		
		var tubeStreamInletTC = eval(document.getElementById("stream2InletThermCond").value)
		var tubeStreamOutletTC = eval(document.getElementById("stream2OutletThermCond").value)
		var tubeStreamMeanTC=mult((tubeStreamInletTC+tubeStreamOutletTC),.5)
		document.getElementById('results').innerHTML += "Stream 2 [Tubeside] Mean Thermal Conductivity: " + tubeStreamMeanTC.cutZero() + " W/m °C<br>"
		
		var tubeStreamInletDensity = eval(document.getElementById("stream2InletDensity").value)
		var tubeStreamOutletDensity = eval(document.getElementById("stream2OutletDensity").value)
		var tubeStreamMeanDensity = mult((tubeStreamInletDensity + tubeStreamOutletDensity),.5)
		document.getElementById('results').innerHTML += "Stream 2 [Tubeside] Mean Density: " + tubeStreamMeanDensity.cutZero() + " kg/m^3<br>"
		
		var tubeStreamInletViscosity = eval(document.getElementById("stream2InletViscosity").value*1e-3)
		var tubeStreamOutletViscosity = eval(document.getElementById("stream2OutletViscosity").value*1e-3)
		var tubeStreamMeanViscosity = mult((tubeStreamInletViscosity + tubeStreamOutletViscosity),.5)
		document.getElementById('results').innerHTML += "Stream 2 [Tubeside] Mean Viscosity: " + (tubeStreamMeanViscosity*1e3).cutZero() + " mNs/m^2 [cP]<br>"
		
		var stream2OutletTemp = stream2InletTemp-duty/(stream2MassFlow*tubeStreamMeanSHC)
		var stream2MeanTemp=mult((stream2InletTemp+stream2OutletTemp),.5)
		var stream2TempDiff = stream2OutletTemp - stream2InletTemp
		document.getElementById('results').innerHTML += "Stream 2 [Tubeside] Outlet Temperature: " + stream2OutletTemp.cutZero() + " °C<br>"
		document.getElementById('results').innerHTML += "Stream 2 [Tubeside] Mean Temperature: " + stream2MeanTemp.cutZero() + " °C<br>"
		
		var currentMode = document.getElementById("currentMode").value
		var currentModeString
		if (currentMode=="counterCurrent"){
			var currentModeString = "Counter-current "
			var LMTDnumerator = (stream1InletTemp - stream2OutletTemp) - (stream1OutletTemp - stream2InletTemp)
			var LMTDdenominator = Math.log((stream1InletTemp - stream2OutletTemp) / (stream1OutletTemp - stream2InletTemp))
			
			var Rnumerator = stream1InletTemp-stream1OutletTemp
			var Rdenominator = stream2OutletTemp-stream2InletTemp
			
			var Snumerator = stream2OutletTemp-stream2InletTemp
			var Sdenominator = stream1InletTemp-stream2InletTemp
		}
		if (currentMode=="coCurrent"){
			var currentModeString = "Co-current "
			var LMTDnumerator = (stream1InletTemp - stream2InletTemp) - (stream1OutletTemp - stream2OutletTemp)
			var LMTDdenominator = Math.log((stream1InletTemp - stream2InletTemp) / (stream1OutletTemp - stream2OutletTemp))
		}
		var R = Rnumerator/Rdenominator
		var S = Snumerator/Sdenominator
		var LMTD = LMTDnumerator/LMTDdenominator
		document.getElementById('results').innerHTML += "<br>" + currentModeString + "Log Mean Temperature Difference, ΔTLM: " + LMTD.cutZero() + " °C<br>"
		document.getElementById('results').innerHTML += "R: " + R.toPrecision(3) + "<br>"
		document.getElementById('results').innerHTML += "S (aka P on chart): " + S.toPrecision(3) + "<br><br>"
		
		var U = eval(document.getElementById("estOverCoeff").value)
		var Ft = eval(document.getElementById("Ft").value)
		var dTm = Ft*LMTD
		var heatTransferArea = Math.abs(duty/mult(mult(U,Ft),LMTD))
		document.getElementById('results').innerHTML += "Actual Temperature Difference, ΔTm: " + dTm.cutZero() + " °C<br>"
		document.getElementById('results').innerHTML += "Heat Transfer Area: " + heatTransferArea.cutZero() + " m^2<br>"
		
		var nShellPass = eval(document.getElementById("nShellPass").value)
		var nTubePass = eval(document.getElementById("nTubePass").value)
		var foo = Math.sqrt(Math.pow(R,2) + 1)
		var Ftnumerator = foo*Math.log((1-S)/(1-R*S))
		var Ftdenominator = (R-1)*Math.log((2-S*(R+ 1 - foo))/(2-S*(R+ 1 + foo)))
		var FtCalculated = Ftnumerator/Ftdenominator
		document.getElementById('results').innerHTML += "<br>For a heat exchanger with " + nShellPass + " shell passes and "
		document.getElementById('results').innerHTML += nTubePass + " tube passes:<br>"
		if (nShellPass==1&&nTubePass==2){
			document.getElementById('results').innerHTML += "Calculated Ft: " + FtCalculated.cutZero() + "<br>"
		}
		
		var outerDiameter = eval(document.getElementById("outerDiameter").value)*1e-3
		var tubeLength = eval(document.getElementById("tubeLength").value)
		var areaPerTube = mult(outerDiameter,tubeLength) * Math.PI
		var nTube = Math.ceil(heatTransferArea/areaPerTube)
		for (i=0;i<nTubePass;i++){
			var nTubePerPass = nTube/nTubePass
			if (nTubePerPass%1==0){
				break;
			} else {
				nTube++
			}
		}
		document.getElementById('results').innerHTML += "<br>Area of one tube, neglecting thickness of tube sheet: " + areaPerTube.cutZero() + " m^2<br>"
		document.getElementById('results').innerHTML += "Number of tubes required, Nt: " + nTube + "<br>"
		document.getElementById('results').innerHTML += "For " + nTubePass + " passes, tubes per pass: " + nTubePerPass + "<br>"
		
		var innerDiameter = eval(document.getElementById("innerDiameter").value)*1e-3
		var tubeCrossArea = mult(Math.pow(innerDiameter,2),.25)*Math.PI
		var areaPerPass = mult(tubeCrossArea,nTubePerPass)
		var volumetricFlow = stream2MassFlow/tubeStreamMeanDensity
		var tubeVelocity = volumetricFlow/areaPerPass
		document.getElementById('results').innerHTML += "<br>Tube Cross-sectional Area: " + tubeCrossArea.cutZero() + " m^2<br>"
		document.getElementById('results').innerHTML += "Area per pass: " + areaPerPass.cutZero() + " m^2<br>"
		document.getElementById('results').innerHTML += "Volumetric Flow of tubeside fluid: " + volumetricFlow.cutZero() + " m^3/s<br>"
		document.getElementById('results').innerHTML += "Tubeside velocity: " + tubeVelocity.cutZero() + " m/s (hopefully between 1 and 2 m/s)<br>"
		
		var listedPassesInTable12point3 = [1,2,4,6,8]
		var currentPitch = document.getElementById("currentPitch").value
		if (currentPitch=="triangular"){
			var Klist=[.319,.249,.175,.0743,.0365];
			var nlist=[2.142,2.207,2.285,2.499,2.675];
		} else if (currentPitch=="square"){
			var Klist=[.215,.156,.158,.0402,.0331];
			var nlist=[2.207,2.291,2.263,2.617,2.643];
		}
		var index = listedPassesInTable12point3.indexOf(nTubePass)
		var requiredK1 = Klist[index]
		var requiredn1 = nlist[index]
		document.getElementById('results').innerHTML += "<br>For " + nTubePass + "-pass " + currentPitch + " pitch:<br>"
		document.getElementById('results').innerHTML += "K1 = " + requiredK1 + "<br>"
		document.getElementById('results').innerHTML += "n1 = " + requiredn1 + "<br>"
		
		var shellClearance = eval(document.getElementById("shellClear").value)*1e-3
		var bundleDiameter = outerDiameter*Math.pow((nTube/requiredK1),(1/requiredn1))
		var shellsideDiameter = bundleDiameter + shellClearance
		document.getElementById('results').innerHTML += "Bundle diameter, Db: " + bundleDiameter.cutZero() + " m<br>"
		document.getElementById('results').innerHTML += "Shell side diameter, Ds: " + shellsideDiameter.cutZero() + " m<br>"
		
		var heatTransferFactor = eval(document.getElementById("heatTransFac").value)
		var reynoldsNumber = mult(mult(tubeStreamMeanDensity,tubeVelocity),innerDiameter)/tubeStreamMeanViscosity
		var prandtlNumber = mult(tubeStreamMeanSHC,tubeStreamMeanViscosity)/tubeStreamMeanTC
		var lengthOverInnerDiameter = tubeLength/innerDiameter
		// Need to figure out Nusselt number in the three flow types.
		var nusseltNumber = mult(heatTransferFactor,reynoldsNumber) * Math.pow(prandtlNumber,.33)
		var insideCoefficient = mult(nusseltNumber,tubeStreamMeanTC)/innerDiameter
		var flowType
		if (reynoldsNumber>1e4){
			flowType = "turbulent"
		} else if (reynoldsNumber<2e3){
			flowType = "laminar"
		} else {
			flowType = "transition"
			
		}
		document.getElementById('results').innerHTML += "<br>Reynolds number, Re: " + reynoldsNumber.cutZero() + " (hence, " + flowType + " region)<br>"
		document.getElementById('results').innerHTML += "Prandtl number, Pr: " + prandtlNumber.cutZero() + "<br>"
		document.getElementById('results').innerHTML += "Ratio of tube length to tube inner diameter: " + lengthOverInnerDiameter.cutZero() + "<br>"
		document.getElementById('results').innerHTML += "Nusselt number, Nu: " + nusseltNumber.cutZero() + "<br>"
		document.getElementById('results').innerHTML += "Inside coefficient, hi: " + insideCoefficient.cutZero() + " W/m °C<br>"
		
	}
	</script>
	
	<p class="hotFluid"><br>Properties of Stream 1 (Shellside) [This stream cools down]<br>
	Mass Flow: <input type="text" class="inputText" id="stream1MassFlow" value="2e4/3600"> kg/s<br>
	Inlet Temperature, T1: <input type="text" class="inputText" id="stream1InletTemp" value="200"> °C<br>
	Outlet Temperature, T2: <input type="text" class="inputText" id="stream1OutletTemp" value="90"> °C<br>
	
	Inlet Spec Heat Capacity, C1: <input type="text" class="inputText" id="stream1InletSHC" value="2470"> J/kgK<br>
	Outlet Spec Heat Capacity, C2: <input type="text" class="inputText" id="stream1OutletSHC" value="2470"> J/kgK<br></p>
	
	<p class="coldFluid"><br>Properties of Stream 2 (Tubeside) [This stream heats up]<br>
	Mass Flow: <input type="text" class="inputText" id="stream2MassFlow" value="7e4/3600"> kg/s<br>
	Inlet Temperature, t1: <input type="text" class="inputText" id="stream2InletTemp" value="40"> °C<br>
	
	Inlet Spec Heat Capacity, c1: <input type="text" class="inputText" id="stream2InletSHC" value="2010"> J/kgK<br>
	Outlet Spec Heat Capacity, c2: <input type="text" class="inputText" id="stream2OutletSHC" value="2010"> J/kgK<br>
	
	Inlet Thermal Conductivity, k1: <input type="text" class="inputText" id="stream2InletThermCond" value=".135"> W/m °C<br>
	Outlet Thermal Conductivity, k2: <input type="text" class="inputText" id="stream2OutletThermCond" value=".133"> W/m °C<br>
	
	Inlet Density, rho1: <input type="text" class="inputText" id="stream2InletDensity" value="840"> kg/m^3<br>
	Outlet Density, rho2: <input type="text" class="inputText" id="stream2OutletDensity" value="800"> kg/m^3<br>
	
	Inlet Viscosity, mu1: <input type="text" class="inputText" id="stream2InletViscosity" value="4.3"> mNs/m^2 [cP]<br>
	Outlet Viscosity, mu2: <input type="text" class="inputText" id="stream2OutletViscosity" value="2.4"> mNs/m^2 [cP]<br></p>
	
	<p class="hEx"><br>Heat Exchanger<br>
	Estimated Overall Coefficient, U: <input type="text" class="inputText" id="estOverCoeff" value="300"> W/m^2 °C<br>
	Mode: <select id = "currentMode">
		<option value="counterCurrent">Counter-current</option>
		<option value="coCurrent">Co-current</option>
	</select><br>
	Correction Factor (get from chart using R and S, must be more than 0.75), Ft: <input type="text" class="inputText" id="Ft" value="0.88"><br>
	Number of shell passes, m: <input type="text" class="inputText" id="nShellPass" value="1"><br>
	Number of tube passes, n : <select id = "nTubePass">
		<option value="1">1</option>
		<option value="2" selected>2</option>
		<option value="4">4</option>
		<option value="6">6</option>
		<option value="8">8</option>
	</select><br>
	Outer diameter, do: <input type="text" class="inputText" id="outerDiameter" value="19.05"> mm<br>
	Inner diameter, di: <input type="text" class="inputText" id="innerDiameter" value="14.83"> mm<br>
	Tube length, L: <input type="text" class="inputText" id="tubeLength" value="5"> m<br>
	Pitch: <select id = "currentPitch">
		<option value="triangular">Triangular</option>
		<option value="square">Square</option>
	</select><br>
	Shell clearance: <input type="text" class="inputText" id="shellClear" value="56"> mm<br>
	Heat Transfer Factor, jh: <input type="text" class="inputText" id="heatTransFac" value="3.2e-3"><br></p>
	
	<p>Other
	Significant figures: <input type="text" class="inputText" id="signif" value="15"><br></p>
	
	<br><input type=button value="Calculate" onClick="calculate_this()"><br>
	<br><span id="results">(click "Calculate")</span>
	
	</body>
</html>
